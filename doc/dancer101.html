<html><head><title>Contribution:Dancer</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Sun Jul 20 01:56:05 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<a name='___top' class='dummyTopAnchor' ></a>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#Contribution%3ADancer'>Contribution:Dancer</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Objects'>Objects</a>
    <li class='indexItem indexItem2'><a href='#C101%3A%3AModel'>C101::Model</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Classes'>Classes</a>
      <li class='indexItem indexItem3'><a href='#method_C101%3A%3AModel%3A%3Arenew_uuid'>method C101::Model::renew_uuid</a>
      <li class='indexItem indexItem3'><a href='#method_C101%3A%3AModel%3A%3Avisit(C101%3A%3AVisitor_%24visitor%2C_%24parent%3F%2C_%24index%3F)'>method C101::Model::visit(C101::Visitor $visitor, $parent?, $index?)</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#C101%3A%3AOperations'>C101::Operations</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#cut(Company%7CDepartment%7CEmployee%2C_...)'>cut(Company|Department|Employee, ...)</a>
      <li class='indexItem indexItem3'><a href='#depth(Company%7CDepartment%7CEmployee%2C_...)'>depth(Company|Department|Employee, ...)</a>
      <li class='indexItem indexItem3'><a href='#median(Company%7CDepartment%7CEmployee%2C_...)'>median(Company|Department|Employee, ...)</a>
      <li class='indexItem indexItem3'><a href='#total(Company%7CDepartment%7CEmployee%2C_...)'>total(Company|Department|Employee, ...)</a>
      <li class='indexItem indexItem3'><a href='#uuids(Company%7CDepartment%7CEmployee%2C_...)'>uuids(Company|Department|Employee, ...)</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#C101%3A%3APersistence'>C101::Persistence</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#serialize(%24thing%2C_%24filename)%3E%2Funserialize(%24filename)'>serialize($thing, $filename)&#62;/unserialize($filename)</a>
      <li class='indexItem indexItem3'><a href='#parse(%24json%2C_%5B%24type%5D)%3E%2Funparse(Company%7CDepartment%7CEmployee)'>parse($json, [$type])&#62;/unparse(Company|Department|Employee)</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#C101%3A%3ASample'>C101::Sample</a>
    <li class='indexItem indexItem2'><a href='#C101%3A%3AServer'>C101::Server</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#method_save()'>method save()</a>
      <li class='indexItem indexItem3'><a href='#method_handle_index()'>method handle_index()</a>
      <li class='indexItem indexItem3'><a href='#method_handle_add(Str_%3A%24type%2C_Str_%3A%24list%2C_ArrayRef%5BTuple%5BStr%2C_Str%5D%5D_%3A%24validate)'>method handle_add(Str :$type, Str :$list, ArrayRef[Tuple[Str, Str]] :$validate)</a>
      <li class='indexItem indexItem3'><a href='#method_handle_edit(Str_%3A%24title%2C_Str_%3A%24type%2C_ArrayRef%5BTuple%5BStr%2C_Str%5D%5D_%3A%24validate)'>method handle_edit(Str :$title, Str :$type, ArrayRef[Tuple[Str, Str]] :$validate)</a>
      <li class='indexItem indexItem3'><a href='#method_handle_delete()'>method handle_delete()</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#C101%3A%3AVisitor'>C101::Visitor</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Regular_Visits'>Regular Visits</a>
      <li class='indexItem indexItem3'><a href='#Advanced_Visits'>Advanced Visits</a>
    </ul>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="Contribution:Dancer"
>Contribution:Dancer</a></h1>

<p>This documentation describes each of the Perl Module (<code>.pm</code>) files.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Objects"
>Objects</a></h2>

<p>This contribution uses <a href="http://search.cpan.org/~tobyink/Moops" class="podlinkurl"
>Moops</a> for its object models.
Accessors are automatically provided for all properties and they all work the same,
so they won&#39;t be documented explictly for every property.</p>

<p>The accessors are methods with the same name as the property.
For example,
to get the <code>name</code> property from some object <code>obj</code>,
you would write <code>my $name = $obj-&#62;name</code>.
To set a name,
just pass the new name as the parameter: <code>$obj-&#62;name($new_name)</code>.</p>

<p>Private properties and methods start with an underscore,
but their privacy isn&#39;t enforced by the language.
Still,
you shouldn&#39;t mess with them.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="C101::Model"
>C101::Model</a></h2>

<p>The object model for 101Companies.
Contains classes for Companies,
Departments and Employees,
which are all extensions of the Model class.</p>

<p>Each model object has a name and a UUID,
the latter of which will be generated automatically and can be renewed with <a href="#method_C101%3A%3AModel%3A%3Arenew_uuid" class="podlinkpod"
>renew_uuid</a>.</p>

<p>There is also the two roles <i>Departments</i> and <i>Employees</i>,
which give a model class a list of Departments or Employees respectively.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Classes"
>Classes</a></h3>

<dl>
<dt><a name="Company_extends_Model_with_Departments"
><i>Company</i> extends Model with Departments</a></dt>

<dd>
<dt><a name="Department_extends_Model_with_Departments,_Employees"
><i>Department</i> extends Model with Departments,
Employees</a></dt>

<dd>
<dt><a name="Employee_extends_Model"
><i>Employee</i> extends Model</a></dt>
</dl>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="method_C101::Model::renew_uuid"
>method C101::Model::renew_uuid</a></h3>

<p>Gives the object a newly generated UUID.
The old UUID is returned.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="method_C101::Model::visit(C101::Visitor_$visitor,_$parent?,_$index?)"
>method C101::Model::visit(C101::Visitor $visitor,
$parent?,
$index?)</a></h3>

<p>Hosts a visit for the given $visitor.
This will call the visitor&#39;s appropriate <i>begin</i> callback,
then visit all its Employees and then Departments (if the object implements those respective roles) and finally call the visitor&#39;s appropriate <i>end</i> callback.</p>

<p>When visiting Employees or Departments,
the list that is being iterated through and a reference to the iteration index will be passed as $parent and $index respectively.
When calling this method from somewhere else,
make sure to pass such a list and index reference if your visitor needs it.</p>

<p>See also <a href="#C101%3A%3AVisitor" class="podlinkpod"
>&#34;C101::Visitor&#34;</a>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="C101::Operations"
>C101::Operations</a></h2>

<p>Simple feature implementations,
like total and cut.
Each of the operations takes a list of zero or more Companies,
Departments and Employees (or a mix of them).</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="cut(Company|Department|Employee,_...)"
>cut(Company|Department|Employee,
...)</a></h3>

<p>Implements Feature:Cut.
Halves all employees&#39; salaries,
salaries of 0 are left alone.
Returns a list in list context and a list reference in scalar context.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="depth(Company|Department|Employee,_...)"
>depth(Company|Department|Employee,
...)</a></h3>

<p>Implements Feature:Depth.
Returns the maximum depth of the given objects.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="median(Company|Department|Employee,_...)"
>median(Company|Department|Employee,
...)</a></h3>

<p>Implements Feature:Median.
Returns the median salary of all given employees.
If there are no employees,
0 will be returned.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="total(Company|Department|Employee,_...)"
>total(Company|Department|Employee,
...)</a></h3>

<p>Implements Feature:Total.
Returns the sum of all given employees&#39; salaries.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="uuids(Company|Department|Employee,_...)"
>uuids(Company|Department|Employee,
...)</a></h3>

<p>Returns a reference to a hash mapping from UUIDs to their respective Company,
Department or Employee.
Dies if one of the UUIDs is not actually unique.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="C101::Persistence"
>C101::Persistence</a></h2>

<p>Contains serialization and parsing features.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="serialize($thing,_$filename)&#62;/unserialize($filename)"
>serialize($thing,
$filename)&#62;/unserialize($filename)</a></h3>

<p>Implements Feature:Serialization.
Serializes the given thing to the given file and unserializes a thing from the given file.
The thing must be some kind of scalar.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="parse($json,_[$type])&#62;/unparse(Company|Department|Employee)"
>parse($json,
[$type])&#62;/unparse(Company|Department|Employee)</a></h3>

<p>Implements Feature:Parsing and Feature:Unparsing.
Parses the given JSON string into a Company,
Department or Employee object and unparses such an object into a JSON string.
For parsing,
the type of the parsed object can be given (<code>&#39;company&#39;</code>,
<code>&#39;department&#39;</code> or <code>&#39;employee&#39;</code>),
otherwise it will be guessed.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="C101::Sample"
>C101::Sample</a></h2>

<p>Calling <code>sample()</code> will return a newly created sample Company.
It&#39;s always the same company,
only the UUIDs will differ.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="C101::Server"
>C101::Server</a></h2>

<p>A class for a bunch of helper operations for the Web UI feature.
No parameters are needed for construction.</p>

<p>Has a companies array reference that is deserialized from the file <i>companies.bin</i> upon construction.
There is also a hash of UUIDs mapping to their respective objects,
but that&#39;s private.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="method_save()"
>method save()</a></h3>

<p>Serializes the companies into the file <i>companies.bin</i>.
Returns nothing interesting.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="method_handle_index()"
>method handle_index()</a></h3>

<p>Handles a request for the main page and returns the response.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="method_handle_add(Str_:$type,_Str_:$list,_ArrayRef[Tuple[Str,_Str]]_:$validate)"
>method handle_add(Str :$type,
Str :$list,
ArrayRef[Tuple[Str,
Str]] :$validate)</a></h3>

<p>Handle a GET,
POST or AJAX request to add a new object to the tree.
The $type is either <code>&#39;Company&#39;</code>,
<code>&#39;Department&#39;</code> or <code>&#39;Employee&#39;</code>.
$list is the name of the list in the parent item.
$validate contains a list of pairs.
Each pair has the name of a parameter and the type of that parameter,
which is either <code>&#39;Str&#39;</code> or <code>&#39;UnsignedNum&#39;</code>.</p>

<p>This will check if the given <code>param(&#39;uuid&#39;)</code> corresponds to a valid object,
then validate the form parameters according to $validate and finally create the new object.
The client is informed about success or failure.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="method_handle_edit(Str_:$title,_Str_:$type,_ArrayRef[Tuple[Str,_Str]]_:$validate)"
>method handle_edit(Str :$title,
Str :$type,
ArrayRef[Tuple[Str,
Str]] :$validate)</a></h3>

<p>Like handle_add,
but for editing.
Instead of a $list there is a $title that should be ready to be <i>sprintf</i>ed to with the name of the object being edited.
For example,
<code>&#39;Edit Employee %s&#39;</code>.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="method_handle_delete()"
>method handle_delete()</a></h3>

<p>Handles a GET,
POST or AJAX request for deleting an object.</p>

<p>Checks if <code>param(&#39;uuid&#39;)</code> corresponds to a valid object and then deletes that object and all its children from the tree and the hash of UUIDs.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="C101::Visitor"
>C101::Visitor</a></h2>

<p>Visitor class for traversing the object tree of Companies,
Departments and Employees.</p>

<p>The class provides the following six callbacks that are called when the traversal enters or exits the given type ($self being the visitor itself):</p>

<dl>
<dt><a name="begin_company($self,_$company,_$parent?,_$index?)"
><code>begin_company($self,
$company,
$parent?,
$index?)</code></a></dt>

<dd>
<dt><a name="begin_department($self,_$department,_$parent?,_$index?)"
><code>begin_department($self,
$department,
$parent?,
$index?)</code></a></dt>

<dd>
<dt><a name="begin_employee($self,_$employee,_$parent?,_$index?)"
><code>begin_employee($self,
$employee,
$parent?,
$index?)</code></a></dt>

<dd>
<dt><a name="end_employee($self,_$employee,_$parent?,_$index?)"
><code>end_employee($self,
$employee,
$parent?,
$index?)</code></a></dt>

<dd>
<dt><a name="end_department($self,_$department,_$parent?,_$index?)"
><code>end_department($self,
$department,
$parent?,
$index?)</code></a></dt>

<dd>
<dt><a name="end_company($self,_$company,_$parent?,_$index?)"
><code>end_company($self,
$company,
$parent?,
$index?)</code></a></dt>
</dl>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Regular_Visits"
>Regular Visits</a></h3>

<p>To actually visit something,
fill the callbacks you need with appropriate subs and call a Company&#39;s,
Department&#39;s or Employee&#39;s <code>visit</code> function.
For example,
a visitor to print the structure of an object tree <code>$obj</code>:</p>

<pre>    my $depth   = 0;
    my $visitor = C101::Visitor-&#62;new({
        begin_company =&#62; sub {
            my ($self, $company) = @_;
            print &#34;\t&#34; x $depth++, &#34;Company: ${\$company-&#62;name}\n&#34;;
        },
        begin_department =&#62; sub {
            my ($self, $department) = @_;
            print &#34;\t&#34; x $depth++, &#34;Department: ${\$department-&#62;name}\n&#34;;
        },
        begin_employee =&#62; sub {
            my ($self, $employee) = @_;
            print &#34;\t&#34; x $depth++, &#34;Employee: ${\$employee-&#62;name}\n&#34;;
        },
        end_employee =&#62; sub {
            my ($self, $employee) = @_;
            print &#34;\t&#34; x $depth,   &#34;Address: ${\$employee-&#62;salary}\n&#34;;
            print &#34;\t&#34; x $depth--,  &#34;Salary: ${\$employee-&#62;salary}\n&#34;;
        },
        end_department =&#62; sub {
            --$depth;
        },
        end_company =&#62; sub {
            --$depth;
        },
    });
    $obj-&#62;visit($visitor);</pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Advanced_Visits"
>Advanced Visits</a></h3>

<p>More complicated structural operations like additions or deletions are still possible with visitors, but they require a bit more reflection. So in the callbacks, $parent is a reference to the list that is currently being iterated through and of which the current element is a part of and $index is a reference to the iteration index. At top level, you may not be iterating through a list at all (e.g. because you&#39;re only visiting a single company), which is why those parameters are optional.</p>

<p>You need to make sure that when modifying the parent list, you probably also need to modify the iteration $index. For example, when you want to fire every employee with a salary over 9999.99 as part of a 99% ralley, you need to decrement the index every time that happens. Otherwise the index would be incremented normally on the next iteration and you&#39;d potentially skip over a part of the 1%.</p>

<pre>    my $visitor = C101::Visitor-&#62;new({
        begin_employee =&#62; sub {
            my ($self, $employee, $parent, $index) = @_;
            delete $parent-&#62;[$$index--] if $employee-&#62;salary &#62; 9999.99;
        },
    });
    $obj-&#62;visit($visitor);</pre>

<!-- end doc -->

</body></html>
